app: acestream-3.1.49
ingredients:
  dist: stretch
  sources:
    - deb http://deb.debian.org/debian stretch main
  packages:
    - curl
    - libpython2.7
    - net-tools
    - python-apsw
    - python-lxml
    - python-m2crypto
    - python-pkg-resources

  script:
    - curl --silent "http://acestream.org/downloads/linux/acestream_3.1.49_debian_9.9_x86_64.tar.gz" | tar --extract --gzip
    - curl https://iwf1.com/scrapekod/icons/script.module.torrent.ts.png -L -o acestream-3.1.49.png
    - whereis python

script:
  - touch acestream-3.1.49.desktop
  - sed -i -e 's|/usr/bin/acestream-3.1.49|AppRun --client-console|g' acestream-3.1.49.desktop
  - mkdir -p opt/acestream
  - cp -rf ../{acestream.conf,acestreamengine,start-engine,data,lib} opt/acestream
  - cp ../acestream-3.1.49.png usr/share/icons/hicolor/acestream-3.1.49.png
#  - cp -rf opt/acestream/lib/* usr/lib/
  - cat > acestream-3.1.49.desktop <<EOF
  - [Desktop Entry]
  - Type=Application
  - Name=AceStream-3.1.49
  - Icon=/usr/share/icons/hicolor/acestream-3.1.49.png
  - Exec=/usr/bin/acestream-3.1.49 --client-console
  - Categories=GNOME;GTK;Network;
  - StartupNotify=true
  - EOF
  - cat > ./AppRun <<\EOF
  - #!/bin/sh
  - HERE=$(dirname $(readlink -f "${0}"))
  - ROOT="${HERE}"/opt/acestream
  - export LD_LIBRARY_PATH="$HERE/usr/lib":$LD_LIBRARY_PATH
  - export LD_LIBRARY_PATH="$HERE/usr/lib/x86_64-linux-gnu":$LD_LIBRARY_PATH
  - export LD_LIBRARY_PATH="$HERE/lib":$LD_LIBRARY_PATH
  - export LD_LIBRARY_PATH="$HERE/lib/x86_64-linux-gnu":$LD_LIBRARY_PATH
#  - export LD_LIBRARY_PATH="$ROOT/lib":$LD_LIBRARY_PATH
#  - export LD_LIBRARY_PATH="$HERE/lib/python2.7":$LD_LIBRARY_PATH
  - export PYTHONHOME="$ROOT/lib":$PYTHONHOME
  - export PATH="$HERE/bin":"$HERE/sbin":"$HERE/usr/bin":"$HERE/usr/sbin":"$PATH"
  - LD_LIBRARY_PATH="$ROOT/lib":$LD_LIBRARY_PATH "${ROOT}"/acestreamengine --lib-path "$ROOT" "$@"
  - EOF
  - chmod a+x ./AppRun
  - ./opt/acestream/acestreamengine --version | grep -Eo "[0-9.]+" | head -n 1 > ../VERSION
