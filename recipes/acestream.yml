app: acestream-$ACE_VERSION
ingredients:
  dist: stretch
  sources:
    - deb http://deb.debian.org/debian stretch main
  packages:
    - curl
    - libpython2.7
    - net-tools
    - python-apsw
    - python-lxml
    - python-m2crypto
    - python-pkg-resources
	- gtk2-engines
	- gtk2-engines-cleanice
	- gtk2-engines-murrine

  script:
    - curl --silent http://acestream.org/downloads/linux/acestream_"$ACE_VERSION"_debian_9.9_x86_64.tar.gz | tar --extract --gzip
    - curl https://iwf1.com/scrapekod/icons/script.module.torrent.ts.png -L -o acestream-$ACE_VERSION.png

script:
  - touch acestream-$ACE_VERSION.desktop
  - sed -i -e "s/\/usr\/bin\/acestream-$ACE_VERSION/AppRun/g" acestream-$ACE_VERSION.desktop
  - mkdir -p opt/acestream
  - cp -rf ../{acestream.conf,acestreamengine,start-engine,data,lib} opt/acestream
  - cp ../acestream-$ACE_VERSION.png usr/share/icons/hicolor/acestream-$ACE_VERSION.png
  - cp -rf usr/lib/python2.7/lib-dynload/* usr/lib/python2.7/
  - cat > acestream-$ACE_VERSION.desktop <<EOF
  - [Desktop Entry]
  - Type=Application
  - Name=AceStream-$ACE_VERSION
  - Icon=/usr/share/icons/hicolor/acestream-$ACE_VERSION.png
  - Exec=/usr/bin/acestream-$ACE_VERSION
  - Categories=GNOME;GTK;Network;
  - StartupNotify=true
  - EOF
  - cat > ./AppRun <<\EOF
  - #!/bin/sh
  - HERE=$(dirname $(readlink -f "${0}"))
  - ROOT="${HERE}"/opt/acestream
  - export LD_LIBRARY_PATH="$ROOT/lib":"$HERE/usr/lib/x86_64-linux-gnu":"$HERE/usr/lib/python2.7"
  - export PYTHONHOME="$HERE/usr":$PYTHONHOME
  - export PATH="$HERE/bin":"$HERE/sbin":"$HERE/usr/bin":"$HERE/usr/sbin":"$PATH"
  - ACE_VERSION=$("${ROOT}"/acestreamengine --version | grep -Eo "[0-9.]+" | head -n 1)
  - cp -rf "$HERE"/usr/share/icons/hicolor/acestream-$ACE_VERSION.png /home/$USER/.local/share/icons/
  - cp -rf "$HERE"/acestream-$ACE_VERSION.desktop /home/$USER/.local/share/applications/
  - sed -i '4,5d' /home/$USER/.local/share/applications/acestream-$ACE_VERSION.desktop
  - sed -i -e "3a\Exec=$APPIMAGE\nIcon=/home/$USER/.local/share/icons/acestream-$ACE_VERSION.png" /home/$USER/.local/share/applications/acestream-$ACE_VERSION.desktop
  - "${ROOT}"/acestreamengine --lib-path "${ROOT}" "$@"
  - EOF
  - chmod a+x ./AppRun
  - echo $ACE_VERSION > ../VERSION
